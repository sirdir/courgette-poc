plugins {
    id 'java'
    id 'idea'
}

group 'sirdir.space'
version '1.0-SNAPSHOT'

sourceCompatibility = 1.8

repositories {
    jcenter()
}

test {
    debug = true
//    useTestNG()
    testLogging.showStandardStreams = true
//    beforeTest { descriptor ->
//        logger.lifecycle("Running test: " + descriptor)
//    }
//    onOutput { descriptor, event ->
//        logger.lifecycle("Test: " + descriptor + " produced standard out/err: " + event.message )
//    }
}


task executeFeatures(type: Test) {
    // enable TestNG support (default is JUnit)
    useTestNG()
    options {
        useDefaultListeners = false
//        listeners << ''
//        jvmArgs = ['-Dcucumber.options=--help']
        jvmArgs = ['-Dcucumber.options= ' +
                           '--glue com.steps ' +
                           '--plugin pretty ' +
                           '--plugin json:build/cucumber/cucumber.json ' +
                           '--plugin rerun:build/cucumber/rerun.txt'/* +
                           splitFeatureFolders(featureFolders) + ' ' +
                           cucumberOptions*/]
    }

    // show standard out and standard error of the test JVM(s) on the console
    testLogging.showStandardStreams = true

    // set JVM arguments for the test JVM(s)
    scanForTestClasses = false
    // ignoreFailures = true

    //turn off Gradle's HTML report to avoid replacing the reports generated by TestNG library:
    reports.getHtml().enabled = false

//    doLast {
//        generateReport('build/cucumber/cucumber.json', 'build/cucumber/reports')
//    }
}


dependencies {
    compile('io.cucumber:cucumber-java:4.3.0')
    compile('io.cucumber:cucumber-testng:4.3.0')
}
